<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Book Worms Society" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <nav>
      <%= link_to 'New Post', new_post_path %>
      <%= link_to 'Login', '#' %>
      <%= link_to 'Join', '#' %>
    </nav>

    <div style="position: fixed; top: 1rem; right: 1rem; width: 15rem; z-index: 1050;">
      <% flash.each do |type, message| %>
        <% bootstrap_class = case type.to_sym
          when :notice then "alert-success"
          when :alert  then "alert-danger"
          when :warning then "alert-warning"
          when :info then "alert-info"
          else "alert-secondary"
        end %>

        <div
          class="alert <%= bootstrap_class %> fade show auto-dismiss-alert"
          role="alert"
          style="margin-bottom: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15);"
        >
          <%= message %>
        </div>
      <% end %>
    </div>

    <%= yield %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      (() => {
        let alertTimeouts = [];

        document.addEventListener("turbo:load", () => {
          alertTimeouts.forEach(clearTimeout);
          alertTimeouts = [];

          const alerts = document.querySelectorAll(".auto-dismiss-alert");

          alerts.forEach(alert => {
            const timeoutId = setTimeout(() => {
              alert.classList.remove("show");
              alert.classList.add("fade");
              setTimeout(() => alert.remove(), 500);
            }, 3000);

            alertTimeouts.push(timeoutId);
          });
        });

        document.addEventListener("turbo:before-cache", () => {
          alertTimeouts.forEach(clearTimeout);
          alertTimeouts = [];
        });
      })();
    </script>
  </body>
</html>
